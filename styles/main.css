html, body { height: 100%; margin: 0; overflow: hidden; background: #0f172a; color: #e2e8f0; font-family: system-ui, sans-serif; }
#ui { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
.ui-panel { pointer-events: auto; }
#three-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

/* Мана орбы */
.mana-bar { display: flex; gap: 6px; align-items: center; }
.mana-orb { 
  width: 18px; height: 18px; border-radius: 50%; 
  background: radial-gradient(circle at 30% 30%, #fff, #8bd5ff 30%, #1ea0ff 70%, #0a67b7); 
  box-shadow: 0 0 10px rgba(30,160,255,0.8); 
}
.mana-slot {
  width: 18px; height: 18px; border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.25);
  background: rgba(255,255,255,0.06);
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.5);
}
.mana-orb--steal-fx {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  pointer-events: none;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.95), rgba(94,234,212,0.9) 45%, rgba(20,184,166,0.8) 75%, rgba(6,95,70,0.8));
  box-shadow: 0 0 10px rgba(45,212,191,0.85);
}
.mana-orb--steal-gain {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  pointer-events: none;
  background: radial-gradient(circle at 40% 40%, rgba(224,242,254,0.95), rgba(14,165,233,0.85) 55%, rgba(37,99,235,0.65) 85%);
  box-shadow: 0 0 12px rgba(56,189,248,0.9);
}
.mana-drain-toast {
  padding: 6px 14px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(248, 113, 113, 0.45);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.55);
  color: #fecaca;
  font-weight: 700;
  letter-spacing: 0.02em;
  font-size: 13px;
  text-shadow: 0 1px 2px rgba(15, 23, 42, 0.7);
  pointer-events: none;
  user-select: none;
  will-change: transform, opacity;
}
/* Кнопка завершения хода с круговым таймером **/
.end-turn-btn {
  position: relative; width: 84px; height: 84px; border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(30,41,59,0.9), rgba(30,41,59,0.85) 45%, rgba(15,23,42,0.95));
  box-shadow: inset 0 2px 10px rgba(0,0,0,0.45), 0 0 0 2px rgba(100,116,139,0.6), 0 8px 24px rgba(15,23,42,0.35);
  border: none; cursor: pointer; color: #0f172a; overflow: hidden; pointer-events: auto;
}
.end-turn-btn:disabled { opacity: 0.6; cursor: not-allowed; }
.end-turn-btn .time-fill { 
  position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 0;
  background: linear-gradient(to bottom, rgba(250,204,21,0.9), rgba(234,179,8,0.85));
  transition: top 220ms ease;
}
.end-turn-btn .label-text { 
  position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 1;
  font-weight: 800; font-size: 13px; color: #f8fafc; text-shadow: 0 1px 0 rgba(0,0,0,0.4);
}
.end-turn-btn .sec-text { 
  position: absolute; left: 0; right: 0; bottom: 6px; text-align: center; z-index: 1;
  font-weight: 700; font-size: 12px; color: #ffffff; opacity: 0.95; text-shadow: 0 1px 2px rgba(0,0,0,0.6);
}
/* Пульсация рамки в последние 10 секунд */
@keyframes urgentPulse {
  0%   { box-shadow: inset 0 2px 10px rgba(0,0,0,0.45), 0 0 0 2px rgba(239,68,68,0.95), 0 0 16px rgba(239,68,68,0.55), 0 0 0 4px rgba(239,68,68,0.22); }
  100% { box-shadow: inset 0 2px 10px rgba(0,0,0,0.45), 0 0 0 2px rgba(239,68,68,1.0), 0 0 22px rgba(239,68,68,0.75), 0 0 0 6px rgba(239,68,68,0.28); }
}
.end-turn-btn.urgent { animation: urgentPulse 0.8s ease-in-out infinite alternate; }
/* Выделение активного игрока */
.active-player-panel { 
  box-shadow: 0 0 0 2px rgba(34,197,94,0.9), 0 0 16px rgba(34,197,94,0.45);
  border-radius: 18px;
}
@keyframes titlePulse {
  0%   { transform: scale(1); }
  100% { transform: scale(1.08); }
}
.title-pulse {
  display: inline-block;
  color: #bbf7d0; /* светло-зелёный */
  text-shadow: 0 0 10px rgba(34,197,94,0.45);
  animation: titlePulse 1.1s ease-in-out infinite alternate;
  will-change: transform;
}

/* Панели */
.overlay-panel { background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 16px; }
/* Глянцевая кнопка с переливом при наведении */
.glossy-btn { position: relative; overflow: hidden; }
.glossy-btn::after {
  content: '';
  position: absolute;
  top: 0; left: -150%;
  width: 100%; height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.0) 100%);
  transform: skewX(-20deg);
  transition: left .5s;
}
.glossy-btn:hover::after { left: 150%; }
/* Prompt: кликабельна только панель, остальное кликается сквозь */
#prompt-panel { pointer-events: none; }
#prompt-panel .overlay-panel { pointer-events: auto; }
/* Оверлеи баннеров */
.banner { pointer-events:none; }
/* Turn Splash — новый вау-экран */
.ts-wrap { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; }
.ts-bg { position: absolute; inset: 0; background: radial-gradient(80% 60% at 50% 50%, rgba(37,99,235,0.22), rgba(2,6,23,0.9)); mix-blend-mode: screen; }
.ts-title { position: relative; font-weight: 900; letter-spacing: 0.06em; line-height: 1; }
.ts-title-solid { color: #ffffff; -webkit-text-stroke: 1px rgba(10,15,25,0.55); paint-order: stroke fill; }
.ts-title-glow { text-shadow: none; }
.ts-ring { position: absolute; width: 40vmin; height: 40vmin; border-radius: 50%; border: 2px solid rgba(255,255,255,.7); }
.ts-ring.thin { width: 55vmin; height: 55vmin; opacity: .45; border-color: rgba(255,255,255,.45); }
.ts-streaks { position: absolute; inset: -20% -20%; transform: rotate(-18deg); background: repeating-linear-gradient(90deg, rgba(255,255,255,0) 0, rgba(255,255,255,0) 16px, rgba(255,255,255,.12) 16px, rgba(255,255,255,.12) 24px); mix-blend-mode: screen; opacity: .35; }
.ts-scan { position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 0, rgba(255,255,255,.12) 40%, transparent 80%); transform: translateY(-100%); }
.battlePop { animation: pop 1100ms ease both; }
@keyframes pop { 0%{ transform:scale(.6); opacity:0 } 40%{ transform:scale(1.06); opacity:1 } 100%{ transform:scale(1); opacity:.96 } }
/* Flashy BATTLE splash */
.battle-flash-wrap { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; }
.battle-flash-bg { position: absolute; inset: 0; background: radial-gradient(80% 60% at 50% 50%, rgba(255,255,255,0.08), rgba(0,0,0,0.8)); mix-blend-mode: screen; }
.battle-flash-text { position: relative; font-weight: 900; letter-spacing: 0.08em; text-shadow: 0 0 20px rgba(255, 236, 153, .9), 0 0 40px rgba(255, 98, 0, .7); }
.battle-flash-scan { position:absolute; inset:0; background: linear-gradient( to bottom, transparent 0%, rgba(255,255,255,0.08) 50%, transparent 100% ); transform: translateY(-100%); }
/* CHECK splash */
.check-wrap { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; }
.check-bg { position: absolute; inset: 0; background: radial-gradient(80% 60% at 50% 50%, rgba(59,130,246,0.25), rgba(30,64,175,0.7), rgba(15,23,42,0.92)); filter: saturate(1.2); }
.check-plate { position: relative; padding: 1.5rem 3.5rem; border-radius: 999px; background: radial-gradient(circle at 50% 50%, rgba(15,118,110,0.9), rgba(6,78,59,0.95)); box-shadow: 0 0 35px rgba(16,185,129,0.65), 0 18px 45px rgba(6,95,70,0.45); border: 1px solid rgba(236,253,245,0.35); }
.check-rays { position: absolute; inset: -20%; background: repeating-conic-gradient(from 0deg, rgba(167,243,208,0.12) 0deg, rgba(167,243,208,0.12) 6deg, transparent 6deg, transparent 12deg); mix-blend-mode: screen; opacity: 0; filter: blur(0.5px); }
.check-ring { position: absolute; width: 48vmin; height: 48vmin; border-radius: 50%; border: 2px solid rgba(110,231,183,0.6); box-shadow: 0 0 20px rgba(34,197,94,0.45); }
.check-title { position: relative; font-weight: 900; letter-spacing: 0.12em; color: #ecfdf5; text-shadow: 0 0 22px rgba(167,243,208,0.8), 0 0 42px rgba(34,197,94,0.55); }
.check-scan { position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 0, rgba(236,253,245,0.18) 40%, transparent 80%); transform: translateY(-100%); mix-blend-mode: screen; }
.control-alert { border-color: rgba(248,113,113,0.75) !important; color: #fee2e2 !important; box-shadow: 0 0 0 2px rgba(248,113,113,0.75), 0 0 26px rgba(248,113,113,0.4); animation: controlAlertPulse 0.42s ease-in-out alternate infinite; }
@keyframes controlAlertPulse {
  0% { background: rgba(30,41,59,0.95); }
  100% { background: rgba(127,29,29,0.7); }
}
/* Tooltip для 3D-колод/кладбищ */
#hover-tooltip { position: fixed; pointer-events: none; z-index: 50; }

#hover-tooltip.unit-tooltip-panel {
  padding: 10px 12px;
  max-width: 260px;
  width: max-content;
  font-size: 12px;
  line-height: 1.45;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.45);
  border: 1px solid rgba(148, 163, 184, 0.25);
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip {
  display: flex;
  flex-direction: column;
  gap: 10px;
  color: #f8fafc;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__stats {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__stat {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(15, 23, 42, 0.55);
  border-radius: 10px;
  padding: 4px 6px;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__icon {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  filter: drop-shadow(0 0 4px rgba(15, 23, 42, 0.35));
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__stat-value {
  font-size: 13px;
  font-weight: 700;
  color: #f8fafc;
  line-height: 1.2;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__divider {
  height: 1px;
  background: linear-gradient(90deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.45), rgba(148, 163, 184, 0.1));
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__section {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__section-title {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: rgba(226, 232, 240, 0.65);
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__desc {
  font-size: 12px;
  color: #e2e8f0;
  white-space: normal;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__statuses {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status {
  padding: 3px 8px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 600;
  background: rgba(226, 232, 240, 0.9);
  color: #0f172a;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.25);
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--empty {
  background: rgba(148, 163, 184, 0.3);
  color: rgba(226, 232, 240, 0.9);
  box-shadow: none;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--possessed {
  background: linear-gradient(135deg, #7c3aed, #ec4899);
  color: #fdf4ff;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--invisible {
  background: #14b8a6;
  color: #022c22;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--perfect-dodge {
  background: #facc15;
  color: #422006;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--dodge {
  background: #38bdf8;
  color: #0c4a6e;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--quickness {
  background: #fb7185;
  color: #7f1d1d;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--fortress {
  background: rgba(148, 163, 184, 0.75);
  color: #1f2937;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--double-attack {
  background: #f97316;
  color: #7c2d12;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--fieldquake {
  background: #6366f1;
  color: #1e1b4b;
}

#hover-tooltip.unit-tooltip-panel .unit-tooltip__status--magic {
  background: #a855f7;
  color: #3b0764;
}

/* Opponent hand count indicator */
#opponent-hand-count {
  position: relative;
  width: 84px;
  height: 24px;
  margin-top: 4px;
}
#opponent-hand-count .opp-card {
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 16px;
  height: 22px;
  margin-left: -8px;
  border: 2px solid #ffffff;
  border-radius: 3px;
  background: #0f172a;
  transform-origin: bottom center;
}

/* Кастомный скроллбар для выбора колоды */
#deck-select-overlay .deck-scroll {
  scrollbar-width: thin;
  scrollbar-color: #475569 rgba(30,41,59,0.7);
}
#deck-select-overlay .deck-scroll::-webkit-scrollbar {
  width: 8px;
}
#deck-select-overlay .deck-scroll::-webkit-scrollbar-track {
  background: rgba(30,41,59,0.7);
}
#deck-select-overlay .deck-scroll::-webkit-scrollbar-thumb {
  background-color: #475569;
  border-radius: 4px;
  border: 2px solid rgba(30,41,59,0.7);
}
#deck-select-overlay .deck-scroll::-webkit-scrollbar-thumb:hover {
  background-color: #64748b;
}

/* Кастомный скроллбар для редактора колод */
#deck-builder-overlay .deck-scroll {
  scrollbar-width: thin;
  scrollbar-color: #475569 rgba(30,41,59,0.7);
}
#deck-builder-overlay .deck-scroll::-webkit-scrollbar {
  width: 8px;
}
#deck-builder-overlay .deck-scroll::-webkit-scrollbar-track {
  background: rgba(30,41,59,0.7);
}
#deck-builder-overlay .deck-scroll::-webkit-scrollbar-thumb {
  background-color: #475569;
  border-radius: 4px;
  border: 2px solid rgba(30,41,59,0.7);
}
#deck-builder-overlay .deck-scroll::-webkit-scrollbar-thumb:hover {
  background-color: #64748b;
}

#deck-builder-overlay .catalog-grid {
  align-content: start;
  justify-items: center;
  padding-bottom: 1rem;
  grid-template-rows: repeat(2, max-content);
  grid-auto-rows: max-content;
  /* Управляющие переменные для адаптивной сетки */
  --deck-catalog-columns: 5;
  --deck-card-scale: 1;
  --deck-card-width: 256px;
  --deck-card-horizontal-padding: 12px;
  --deck-card-aspect: 256 / 356;
  grid-template-columns: repeat(var(--deck-catalog-columns), minmax(0, 1fr));
}

#deck-builder-overlay .catalog-card {
  width: min(100%, calc(var(--deck-card-scale) * var(--deck-card-width) + var(--deck-card-horizontal-padding)));
  padding: 6px;
  border-radius: 18px;
  background: rgba(15,23,42,0.65);
  box-shadow: 0 8px 20px rgba(8,11,20,0.4);
  transition: transform 140ms ease, box-shadow 140ms ease;
  box-sizing: border-box;
  justify-self: center;
}

#deck-builder-overlay .catalog-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 28px rgba(8,11,20,0.48);
}

#deck-builder-overlay .catalog-card canvas {
  display: block;
  border-radius: 14px;
  width: calc(var(--deck-card-scale) * var(--deck-card-width));
  height: auto;
  aspect-ratio: var(--deck-card-aspect);
  max-width: 100%;
  margin: 0 auto;
}
