<!DOCTYPE html>
<html>
<head>
    <title>Test Railway Connection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</h1>
    <div id="status"></div>
    
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        const SERVER_URL = "https://eog-mp-server-production.up.railway.app";
        const statusDiv = document.getElementById('status');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            statusDiv.appendChild(div);
            console.log(message);
        }
        
        log('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ' + SERVER_URL);
        
        const socket = io(SERVER_URL, {
            transports: ['websocket', 'polling'],
            upgrade: true,
            rememberUpgrade: true,
            timeout: 20000,
            forceNew: true
        });
        
        socket.on('connect', () => {
            log('‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω! Socket ID: ' + socket.id, 'success');
            
            // –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
            socket.emit('debugLog', { test: 'connection_test', timestamp: Date.now() });
            log('üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
            
            // –¢–µ—Å—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –æ—á–µ—Ä–µ–¥–∏
            setTimeout(() => {
                socket.emit('joinQueue');
                log('üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –æ—á–µ—Ä–µ–¥–∏');
            }, 1000);
        });
        
        socket.on('connect_error', (error) => {
            log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
        });
        
        socket.on('disconnect', (reason) => {
            log('üîå –û—Ç–∫–ª—é—á–µ–Ω: ' + reason, 'warning');
        });
        
        socket.on('matchFound', ({ matchId, seat }) => {
            log(`üéÆ –ú–∞—Ç—á –Ω–∞–π–¥–µ–Ω! ID: ${matchId}, –º–µ—Å—Ç–æ: ${seat}`, 'success');
        });
        
        // –¢–µ—Å—Ç fetch –∑–∞–ø—Ä–æ—Å–æ–≤
        async function testFetch() {
            try {
                const response = await fetch(SERVER_URL);
                const text = await response.text();
                log('‚úÖ HTTP —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω: ' + text, 'success');
            } catch (error) {
                log('‚ùå HTTP —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: ' + error.message, 'error');
            }
            
            try {
                const response = await fetch(SERVER_URL + '/queue-status');
                const data = await response.json();
                log(`‚úÖ –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏: ${data.queueSize} –∏–≥—Ä–æ–∫–æ–≤, ${data.activeMatches} –º–∞—Ç—á–µ–π`, 'success');
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ—á–µ—Ä–µ–¥–∏: ' + error.message, 'error');
            }
        }
        
        testFetch();
    </script>
</body>
</html>
